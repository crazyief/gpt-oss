# ========================================
# Backend API Environment Configuration
# For use inside Docker container
# ========================================

# ========================================
# Application Settings
# ========================================
# Server configuration
HOST=0.0.0.0
PORT=3000
NODE_ENV=production
PROJECT_ROOT=/app

# Logging
LOG_LEVEL=DEBUG
LOG_FORMAT=json
LLAMA_APPLY_LOG_PATH=/app/logs/llama_apply.log

# ========================================
# Database Configuration (SQLite)
# ========================================
DATABASE_URL=sqlite:////app/data/ultimate_rag.db
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# ========================================
# Storage Configuration (Local Filesystem)
# ========================================
# Document storage paths
UPLOAD_DIR=/app/data/corpus
INDEXES_DIR=/app/data/indexes
TEMP_DIR=/app/data/temp

# File size limits
MAX_FILE_SIZE=100000000  # 100MB
MAX_BATCH_SIZE=50

# ========================================
# Cache Configuration (Memory)
# ========================================
CACHE_TYPE=memory
CACHE_MAX_SIZE=1000
CACHE_TTL=3600  # 1 hour

# ========================================
# Vector Database (Qdrant)
# ========================================
QDRANT_URL=http://qdrant:6333
QDRANT_COLLECTION_NAME=ultimate_rag
QDRANT_GRPC_PORT=6334
QDRANT_TIMEOUT=60

# ========================================
# Search Engine (OpenSearch)
# ========================================
OPENSEARCH_URL=http://opensearch:9200
OPENSEARCH_INDEX_NAME=ultimate_rag
OPENSEARCH_TIMEOUT=30
OPENSEARCH_MAX_RETRIES=3

# ========================================
# LLM Service Configuration
# ========================================
# Main LLM server (Gemma-27B on RTX 5090)
LLAMA_SERVER_URL=http://llm-main:8080
LLAMA_TIMEOUT=300  # 5 minutes for long generations
LLAMA_MAX_RETRIES=3

# LLM generation parameters
DEFAULT_TEMPERATURE=0.1
DEFAULT_TOP_K=20
DEFAULT_TOP_P=0.85
DEFAULT_MAX_TOKENS=8192

# ========================================
# Embedding Service Configuration
# ========================================
EMBEDDING_SERVICE_URL=http://embedding:8081
EMBEDDING_MODEL_NAME=bge-large-zh-v1.5
EMBEDDING_BATCH_SIZE=32
EMBEDDING_MAX_LENGTH=512
EMBEDDING_TIMEOUT=30

# ========================================
# Reranker Service Configuration
# ========================================
RERANKER_URL=http://reranker:8082
RERANKER_MODEL_NAME=bge-reranker-v2-m3
RERANKER_BATCH_SIZE=100
RERANKER_MAX_LENGTH=512
RERANKER_TIMEOUT=30
RERANKER_DISABLE=0  # 0=enabled, 1=disabled

# ========================================
# SPLADE Service Configuration
# ========================================
SPLADE_URL=http://splade:8083
SPLADE_MODEL_NAME=splade-cocondenser-ensembledistil
SPLADE_BATCH_SIZE=16
SPLADE_MAX_LENGTH=256
SPLADE_TIMEOUT=30

# ========================================
# Neo4j Knowledge Graph (Optional - Stage 6)
# ========================================
NEO4J_URL=bolt://neo4j:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password123
NEO4J_DATABASE=neo4j

# ========================================
# RAG Pipeline Configuration
# ========================================
# Retrieval settings
DEFAULT_TOP_K_RETRIEVAL=50  # Initial retrieval count
DEFAULT_TOP_K_RERANK=10     # After reranking
CHUNK_SIZE=512
CHUNK_OVERLAP=128

# HyDE (Hypothetical Document Embeddings)
HYDE_ENABLED=true
HYDE_VARIANTS=3

# Query rewriting
QUERY_REWRITE_ENABLED=true
QUERY_REWRITE_VARIANTS=2

# Evidence highlighting
EVIDENCE_HIGHLIGHTING_ENABLED=true

# Row-level table extraction
USE_ROW_LEVEL=true

# ========================================
# API Security & CORS
# ========================================
CORS_ORIGINS=http://localhost:5173,http://localhost:3000
CORS_ALLOW_CREDENTIALS=true
API_KEY_HEADER=X-API-Key
# API_SECRET_KEY=your-secret-key-here  # Uncomment and set for production

# ========================================
# Performance & Threading
# ========================================
WORKERS=4
THREAD_POOL_SIZE=10
CONNECTION_POOL_SIZE=20
REQUEST_TIMEOUT=60
KEEP_ALIVE_TIMEOUT=65

# ========================================
# Health Check Configuration
# ========================================
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=5
HEALTH_CHECK_RETRIES=3

# ========================================
# Development/Debug Settings
# ========================================
DEBUG_MODE=true
VERBOSE_ERRORS=true
TRACE_REQUESTS=false
PROFILE_REQUESTS=false

# ========================================
# Feature Flags
# ========================================
ENABLE_METRICS=true
ENABLE_TRACING=false
ENABLE_PROFILING=false
ENABLE_CACHE_STATS=true

# ========================================
# Monitoring & Observability
# ========================================
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9091
OPENTELEMETRY_ENABLED=false
SENTRY_DSN=
