{
  "id": "Stage1-api-002",
  "contract_name": "Conversation Management API",
  "version": "1.0.0",
  "base_url": "http://localhost:8000/api",
  "description": "API contract for conversation CRUD operations and search",

  "endpoints": [
    {
      "name": "Create Conversation",
      "method": "POST",
      "path": "/conversations/create",
      "description": "Create a new conversation (chat session)",

      "request": {
        "content_type": "application/json",
        "body_schema": {
          "project_id": {
            "type": "integer",
            "required": false,
            "description": "Optional project association"
          },
          "title": {
            "type": "string",
            "required": false,
            "max_length": 200,
            "description": "Conversation title (auto-generated if not provided)"
          }
        },
        "example": {
          "project_id": 1,
          "title": "New Chat"
        }
      },

      "responses": {
        "201": {
          "description": "Conversation created",
          "schema": {
            "id": "integer",
            "project_id": "integer|null",
            "title": "string",
            "created_at": "datetime",
            "updated_at": "datetime",
            "last_message_at": "datetime|null",
            "message_count": "integer"
          }
        }
      }
    },

    {
      "name": "List Conversations",
      "method": "GET",
      "path": "/conversations/list",
      "description": "List conversations with optional filtering",

      "request": {
        "query_parameters": {
          "project_id": {
            "type": "integer",
            "required": false,
            "description": "Filter by project"
          },
          "limit": {"type": "integer", "default": 50, "max": 100},
          "offset": {"type": "integer", "default": 0}
        }
      },

      "responses": {
        "200": {
          "schema": {
            "conversations": "array",
            "total_count": "integer"
          },
          "example": {
            "conversations": [
              {
                "id": 1,
                "project_id": 1,
                "title": "Discuss IEC 62443",
                "created_at": "2025-11-17T10:00:00Z",
                "last_message_at": "2025-11-17T10:30:00Z",
                "message_count": 12
              }
            ],
            "total_count": 1
          }
        }
      }
    },

    {
      "name": "Get Conversation",
      "method": "GET",
      "path": "/conversations/{id}",
      "description": "Retrieve single conversation details",

      "request": {
        "path_parameters": {
          "id": {"type": "integer", "description": "Conversation ID"}
        }
      },

      "responses": {
        "200": {
          "schema": {
            "id": "integer",
            "project_id": "integer|null",
            "title": "string",
            "created_at": "datetime",
            "updated_at": "datetime",
            "last_message_at": "datetime|null",
            "message_count": "integer",
            "metadata": "object"
          }
        },
        "404": {
          "description": "Conversation not found",
          "schema": {"detail": "string"}
        }
      }
    },

    {
      "name": "Update Conversation",
      "method": "PATCH",
      "path": "/conversations/{id}",
      "description": "Update conversation title or metadata",

      "request": {
        "path_parameters": {
          "id": {"type": "integer"}
        },
        "body_schema": {
          "title": {
            "type": "string",
            "required": false,
            "max_length": 200
          }
        }
      },

      "responses": {
        "200": {
          "description": "Conversation updated",
          "schema": {
            "id": "integer",
            "title": "string",
            "updated_at": "datetime"
          }
        }
      }
    },

    {
      "name": "Delete Conversation",
      "method": "DELETE",
      "path": "/conversations/{id}",
      "description": "Soft delete a conversation",

      "request": {
        "path_parameters": {
          "id": {"type": "integer"}
        }
      },

      "responses": {
        "204": {
          "description": "Conversation deleted (no content)"
        },
        "404": {
          "description": "Conversation not found"
        }
      },

      "notes": "Implements soft delete using deleted_at column. Messages are retained for recovery."
    },

    {
      "name": "Search Conversations",
      "method": "GET",
      "path": "/conversations/search",
      "description": "Search conversations by keyword",

      "request": {
        "query_parameters": {
          "q": {
            "type": "string",
            "required": true,
            "description": "Search query"
          },
          "limit": {"type": "integer", "default": 50},
          "offset": {"type": "integer", "default": 0}
        }
      },

      "responses": {
        "200": {
          "schema": {
            "conversations": "array",
            "total_count": "integer"
          }
        }
      },

      "notes": "Searches conversation titles using SQLite LIKE or FTS5 for better performance"
    }
  ],

  "data_models": {
    "Conversation": {
      "id": "integer (primary key)",
      "project_id": "integer (foreign key, nullable)",
      "title": "string (max 200)",
      "created_at": "datetime",
      "updated_at": "datetime",
      "deleted_at": "datetime (nullable)",
      "last_message_at": "datetime (nullable)",
      "message_count": "integer",
      "metadata": "JSON object"
    }
  }
}
